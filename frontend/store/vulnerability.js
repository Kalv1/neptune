const state = () => ({
  vuln: [],
  notes: []
})

const mutations = {
  setVuln(state, data) {
    state.vuln = data
  },

  changeState(state, data) {
    state.vuln.find((vuln) => vuln.id === data.cve).active = data.active
  }
}

const actions = {
  async getVulnerabilties({commit}, {page, perPage}) {
    await this.$axios.get(`/api/vulnerabilities?page=${page}&per_page=${perPage}`).then(({data}) => {
      commit('setVuln', data)
    })
  },

  async setNotes({commit}, { cve, notes, active }) {
    await this.$axios.put(`/api/vulnerabilities/${cve}`, { notes, active })
  },

  async setAckState({commit}, { cve, notes, active }) {
    await this.$axios.put(`/api/vulnerabilities/${cve}`, { notes, active })
    commit('changeState', { cve, active })
  }
}

export default {
  state,
  mutations,
  actions
}

